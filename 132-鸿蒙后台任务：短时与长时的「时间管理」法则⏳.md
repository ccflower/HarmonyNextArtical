
# é¸¿è’™åŽå°ä»»åŠ¡ï¼šçŸ­æ—¶ä¸Žé•¿æ—¶çš„ã€Œæ—¶é—´ç®¡ç†ã€æ³•åˆ™â³  

å—¨ï½žæˆ‘æ˜¯å°Lï¼åœ¨é¸¿è’™å¼€å‘é‡Œï¼ŒåŽå°ä»»åŠ¡å°±åƒã€Œæ—¶é—´ç®¡å®¶ã€â€”â€”çŸ­æ—¶ä»»åŠ¡å¤„ç†ç´§æ€¥å°äº‹ï¼Œé•¿æ—¶ä»»åŠ¡æžå®šæŒä¹…å·¥ä½œã€‚ä»Šå¤©å¸¦ä½ å¿«é€Ÿæžæ‡‚ä¸¤è€…çš„åŒºåˆ«å’Œå®žæˆ˜æŠ€å·§ï½ž  


## ä¸€ã€çŸ­æ—¶ä»»åŠ¡ï¼šåŽå°çš„ã€ŒåŠ æ€¥å¿«ä»¶ã€ðŸšš  
### é€‚ç”¨åœºæ™¯  
- **ç´§æ€¥ä½†è€—æ—¶çŸ­**ï¼šä¿å­˜ä¸´æ—¶æ•°æ®ã€å‘é€å³æ—¶æ¶ˆæ¯ã€çŸ­æ—¶ç½‘ç»œè¯·æ±‚  
- **å…¸åž‹ä¾‹å­**ï¼š  
  - é€€å‡ºåº”ç”¨å‰å¿«é€Ÿä¿å­˜æœªæäº¤çš„è¡¨å•  
  - åŽå°åŒæ­¥ä¸€æ¬¡ç”¨æˆ·è®¾ç½®å˜æ›´  

### ç”³è¯·ã€Œä¸‰è¦ç´ ã€  
1. **æ—¶æœº**ï¼šå¿…é¡»åœ¨å‰å°æˆ–`onBackground`å›žè°ƒä¸­ç”³è¯·  
2. **æ•°é‡**ï¼šåŒä¸€æ—¶åˆ»æœ€å¤š3ä¸ªï¼Œé¿å…ã€Œå µè½¦ã€  
3. **æ—¶é•¿**ï¼š  
   - æ™®é€šåœºæ™¯ï¼šå•æ¬¡æœ€é•¿3åˆ†é’Ÿ  
   - ä½Žç”µé‡ï¼šå¼ºåˆ¶ç¼©çŸ­è‡³1åˆ†é’Ÿ  
   - æ¯æ—¥æ€»é…é¢ï¼šé»˜è®¤10åˆ†é’Ÿ  

### å®žæˆ˜ä»£ç ï¼ˆç”³è¯·+è¶…æ—¶å¤„ç†ï¼‰  
```typescript  
import { backgroundTaskManager } from '@ohos.backgroundTaskManager';  

// ç”³è¯·çŸ­æ—¶ä»»åŠ¡  
function requestShortTask() {  
  const requestId = backgroundTaskManager.requestSuspendDelay(  
    'sync-user-settings', // ä»»åŠ¡åŽŸå› ï¼ˆå¿…å¡«ï¼‰  
    () => {  
      // è¶…æ—¶å‰å›žè°ƒï¼šæ¸…ç†çŽ°åœº  
      console.log('ä»»åŠ¡å³å°†è¶…æ—¶ï¼Œå–æ¶ˆä»»åŠ¡');  
      backgroundTaskManager.cancelSuspendDelay(requestId);  
    }  
  );  

  // æ£€æŸ¥å‰©ä½™æ—¶é—´  
  backgroundTaskManager.getRemainingDelayTime(requestId).then(res => {  
    console.log(`å‰©ä½™æ—¶é—´ï¼š${res}ç§’`);  
  });  
}  
```  

### æ³¨æ„äº‹é¡¹âš ï¸  
- **ä¸»åŠ¨å–æ¶ˆ**ï¼šä»»åŠ¡å®ŒæˆåŽå¿…é¡»è°ƒç”¨`cancelSuspendDelay`é‡Šæ”¾é…é¢  
- **é…é¢æ¶ˆè€—**ï¼šä»…åŽå°è¿è¡Œæ—¶è®¡æ—¶ï¼Œå‰å°è¿è¡Œä¸æ‰£æ—¶é—´  


## äºŒã€é•¿æ—¶ä»»åŠ¡ï¼šåŽå°çš„ã€ŒæŒä¹…å·¥ä½œè€…ã€ðŸƒ  
### é€‚ç”¨åœºæ™¯  
- **éœ€æŒç»­è¿è¡Œ**ï¼šéŸ³ä¹æ’­æ”¾ã€å¯¼èˆªã€è®¾å¤‡è¿žæŽ¥ã€å®žæ—¶æ•°æ®é‡‡é›†  
- **å…¸åž‹ä¾‹å­**ï¼š  
  - è·‘æ­¥AppæŒç»­è®°å½•è¿åŠ¨è½¨è¿¹  
  - åœ¨çº¿éŸ³ä¹AppåŽå°æ’­æ”¾æ­Œæ›²  

### å®žçŽ°ã€Œå››æ­¥æ›²ã€  
1. **åˆ›å»ºæ‰¿è½½èƒ½åŠ›**ï¼šæ–°å»º`ContinuousTaskExtensionAbility`  
```typescript  
// MyContinuousTask.ts  
import { ContinuousTaskExtensionAbility } from '@ohos.app.ability';  

export default class MyContinuousTask extends ContinuousTaskExtensionAbility {  
  onContinuousTaskStart(workInfo) {  
    // ä»»åŠ¡å¯åŠ¨ï¼šåˆå§‹åŒ–èµ„æº  
    this.startLocationTracking();  
  }  

  onContinuousTaskStop(workInfo) {  
    // ä»»åŠ¡åœæ­¢ï¼šé‡Šæ”¾èµ„æº  
    this.stopLocationTracking();  
  }  
}  
```  

2. **é…ç½®æ¨¡å—æ–‡ä»¶**ï¼šåœ¨`module.json5`å£°æ˜Ž  
```json  
{  
  "abilities": [  
    {  
      "name": ".MyContinuousTask",  
      "type": "extension",  
      "extension": {  
        "ability": "continuousTask"  
      }  
    }  
  ]  
}  
```  

3. **å¯åŠ¨ä»»åŠ¡**ï¼šåœ¨éœ€è¦çš„åœ°æ–¹è°ƒç”¨  
```typescript  
import { backgroundTaskManager } from '@ohos.backgroundTaskManager';  

function startLongTask() {  
  const taskId = backgroundTaskManager.startContinuousTask({  
    abilityName: 'MyContinuousTask',  
    bundleName: 'com.example.myapp'  
  });  
  console.log(`é•¿æ—¶ä»»åŠ¡å¯åŠ¨ï¼ŒIDï¼š${taskId}`);  
}  
```  

4. **è®¾ç½®è¶…æ—¶ï¼ˆé¿å…ã€Œèµ–ç€ä¸èµ°ã€ï¼‰**  
```typescript  
onContinuousTaskStart(workInfo) {  
  // è®¾ç½®5åˆ†é’Ÿè¶…æ—¶  
  setTimeout(() => {  
    backgroundTaskManager.stopContinuousTask(this.taskId); // ä¸»åŠ¨åœæ­¢  
  }, 5 * 60 * 1000);  
}  
```  


## ä¸‰ã€æ ¸å¿ƒå·®å¼‚å¯¹æ¯”è¡¨ðŸ“Š  
| **ç»´åº¦**         | **çŸ­æ—¶ä»»åŠ¡**                | **é•¿æ—¶ä»»åŠ¡**                |  
|------------------|-----------------------------|-----------------------------|  
| **ç”Ÿå‘½å‘¨æœŸ**     | æœ€é•¿3åˆ†é’Ÿï¼ˆä½Žç”µé‡1åˆ†é’Ÿï¼‰    | éœ€ä¸»åŠ¨åœæ­¢æˆ–è®¾ç½®è¶…æ—¶        |  
| **å¯åŠ¨æ–¹å¼**     | `requestSuspendDelay`        | `startContinuousTask`       |  
| **èµ„æºæ¶ˆè€—**     | è½»é‡çº§ï¼ˆå•ä»»åŠ¡å•çº¿ç¨‹ï¼‰      | å¯ç”³è¯·æ›´å¤šèµ„æºï¼ˆå¦‚åŽå°å®šä½ï¼‰|  
| **ç”¨æˆ·æ„ŸçŸ¥**     | æ— æ˜Žæ˜¾æç¤º                  | çŠ¶æ€æ æ˜¾ç¤ºã€ŒåŽå°è¿è¡Œã€å›¾æ ‡  |  
| **å…¸åž‹åœºæ™¯**     | ä¸´æ—¶åŒæ­¥ã€å¿«é€Ÿè®¡ç®—          | éŸ³ä¹æ’­æ”¾ã€å¯¼èˆªè·Ÿè¸ª          |  


## å››ã€èµ„æºç®¡ç†ã€Œé»„é‡‘æ³•åˆ™ã€  
### 1. çŸ­æ—¶ä»»åŠ¡ï¼šçœç€ç”¨ï¼  
- åˆå¹¶åŒç±»ä»»åŠ¡ï¼šé¿å…å¤šæ¬¡ç”³è¯·ï¼ˆå¦‚æ‰¹é‡æäº¤æ•°æ®ï¼‰  
- ä¼˜å…ˆå‰å°å¤„ç†ï¼šèƒ½åœ¨å‰å°å®Œæˆçš„ç»ä¸æ‹–åˆ°åŽå°  

### 2. é•¿æ—¶ä»»åŠ¡ï¼šç”¨å®Œå³æ­¢ï¼  
- æ˜Žç¡®è¶…æ—¶æ—¶é—´ï¼šé¿å…å¿˜è®°åœæ­¢å¯¼è‡´ã€Œå†…å­˜æ³„æ¼ã€  
- ç›‘å¬ç”µé‡å˜åŒ–ï¼šä½Žç”µé‡æ—¶è‡ªåŠ¨é™çº§ä¸ºçŸ­æ—¶ä»»åŠ¡  
```typescript  
import { batteryManager } from '@ohos.battery';  

batteryManager.on('levelChanged', (level) => {  
  if (level < 20 && this.isLongTaskRunning) {  
    backgroundTaskManager.stopContinuousTask(this.taskId); // åœæ­¢é•¿æ—¶ä»»åŠ¡  
    this.requestShortTask(); // æ”¹ç”¨çŸ­æ—¶ä»»åŠ¡å¤„ç†ç´§æ€¥éƒ¨åˆ†  
  }  
});  
```  

### 3. é€šç”¨ç¦å¿Œâš ï¸  
- âŒ çŸ­æ—¶ä»»åŠ¡é‡Œåšå¤æ‚è®¡ç®—ï¼ˆå¦‚å›¾ç‰‡åŽ‹ç¼©ï¼‰  
- âŒ é•¿æ—¶ä»»åŠ¡ä¸è®¾ç½®è¶…æ—¶ï¼ˆå¯èƒ½è¢«ç³»ç»Ÿå¼ºæ€ï¼‰  
- âœ… æ‰€æœ‰ä»»åŠ¡ç»“æŸåŽæ¸…ç†èµ„æºï¼ˆå¦‚å…³é—­æ–‡ä»¶å¥æŸ„ã€å–æ¶ˆç½‘ç»œè¯·æ±‚ï¼‰  


## äº”ã€å®žæˆ˜åœºæ™¯ï¼šè¿åŠ¨Appçš„ä»»åŠ¡é€‰æ‹©âš½  
### åœºæ™¯æè¿°  
- ç”¨æˆ·å¯åŠ¨è·‘æ­¥æ¨¡å¼åŽï¼ŒAppéœ€æŒç»­è®°å½•ä½ç½®ï¼ˆé•¿æ—¶ä»»åŠ¡ï¼‰  
- è·‘æ­¥è¿‡ç¨‹ä¸­ï¼Œæ¯5åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜ä¸€æ¬¡è¿åŠ¨æ•°æ®ï¼ˆçŸ­æ—¶ä»»åŠ¡ï¼‰  

### å®žçŽ°é€»è¾‘  
1. **é•¿æ—¶ä»»åŠ¡**ï¼š  
   - å¯åŠ¨å®šä½æœåŠ¡ï¼Œå®žæ—¶èŽ·å–ç»çº¬åº¦  
   - è®¾ç½®è¶…æ—¶ï¼šç”¨æˆ·ç»“æŸè·‘æ­¥æˆ–æ‰‹åŠ¨åœæ­¢æ—¶å…³é—­  

2. **çŸ­æ—¶ä»»åŠ¡**ï¼š  
   - æ¯5åˆ†é’Ÿè§¦å‘ä¸€æ¬¡ï¼ŒåŽå°ä¿å­˜æ•°æ®åˆ°æœ¬åœ°æ•°æ®åº“  
   - ä½¿ç”¨`requestSuspendDelay`ç”³è¯·1åˆ†é’Ÿé…é¢å®Œæˆä¿å­˜  


## æ€»ç»“ï¼šä»»åŠ¡é€‰æ‹©ã€Œä¸‰å­—è¯€ã€  
- **çŸ­**ï¼šç´§æ€¥ã€è½»é‡ã€é™æ—¶ï¼ˆç”¨çŸ­æ—¶ï¼‰  
- **é•¿**ï¼šæŒä¹…ã€è¿žç»­ã€éœ€çŠ¶æ€ï¼ˆç”¨é•¿æ—¶ï¼‰  
- **çœ**ï¼šçæƒœé…é¢ï¼Œé¿å…èµ„æºæµªè´¹  